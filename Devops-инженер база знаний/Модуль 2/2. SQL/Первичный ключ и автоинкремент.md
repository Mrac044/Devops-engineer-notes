**Первичный ключ** - однозначно идентифицирует каждую запись внутри таблицы. Задается с помощью фразы `PRIMARY KEY`, которая добавляется после указания типа, когда создается таблица.
#SQL-команда 
```SQL
CREATE TABLE users (
    id BIGINT PRIMARY KEY,
    username VARCHAR(50),
    email VARCHAR(255),
    first_name VARCHAR(50),
    last_name VARCHAR(50),
    created_at TIMESTAMP
);

-- Наполняем таблицу данными
INSERT INTO users (id, created_at, email, first_name, last_name, username) VALUES (1, '2022-06-14 18:31:05.296', 'Trevion53@yahoo.com', 'Lucienne', 'Feil', 'Duncan3');
INSERT INTO users (id, created_at, email, first_name, last_name, username) VALUES (2, '2022-06-14 02:04:13.104', 'Baylee52@yahoo.com', 'Ramiro', 'Wolf', 'Michaela11');
```
[View on DBFiddle](https://www.db-fiddle.com/f/7Zome1rgjV5y8bjx63rf4/0)
Если вставить новую запись со значением, которое уже есть в колонке с первичным ключом, то запрос не выполнится.

## Автогенерация первичного ключа

Автогенерацию первичного ключа часто называют **автоинкрементом (autoincrement)**. Что переводится как _автоматическое увеличение_ и напоминает операцию инкремента из программирования _{plus}{plus}_.

#SQL-команда Такой автоинкремент создается с помощью **GENERATED ALWAYS AS IDENTITY**:

```SQL
CREATE TABLE users (
    id BIGINT GENERATED ALWAYS AS IDENTITY,
    username VARCHAR(50),
    email VARCHAR(255),
    first_name VARCHAR(50),
    last_name VARCHAR(50),
    created_at TIMESTAMP
);
```

#SQL-команда Основной ключ и автоинкремент часто используются вместе:

```SQL
CREATE TABLE users (
    -- Одновременное использование и первичного ключа и автогенерации
    id BIGINT PRIMARY KEY GENERATED ALWAYS AS IDENTITY,
    username VARCHAR(50),
    email VARCHAR(255),
    first_name VARCHAR(50),
    last_name VARCHAR(50),
    created_at TIMESTAMP
);

INSERT INTO users (created_at, email, first_name, last_name, username) VALUES ('2022-06-14 18:31:05.296', 'Trevion53@yahoo.com', 'Lucienne', 'Feil', 'Duncan3');
INSERT INTO users (created_at, email, first_name, last_name, username) VALUES ('2022-06-14 02:04:13.104', 'Baylee52@yahoo.com', 'Ramiro', 'Wolf', 'Michaela11');
INSERT INTO users (created_at, email, first_name, last_name, username) VALUES ('2022-06-14 02:28:26.058', 'Casimer_Cronin@yahoo.com', 'Maureen', 'Romaguera', 'Margarete_Hegmann6');
```

[View On DBFiddle](https://www.db-fiddle.com/f/aabHfxoXhBwFJy4FhqyRsc/0)

|   |   |   |   |   |   |
|---|---|---|---|---|---|
|id|username|email|first_name|last_name|created_at|
|1|Duncan3|[Trevion53@yahoo.com](mailto:Trevion53@yahoo.com)|Lucienne|Feil|2022-06-14T18:31<br><br>.296Z|
|2|Michaela11|[Baylee52@yahoo.com](mailto:Baylee52@yahoo.com)|Ramiro|Wolf|2022-06-14T02:04<br><br>.104Z|
|3|Margarete_Hegmann6|[Casimer_Cronin@yahoo.com](mailto:Casimer_Cronin@yahoo.com)|Maureen|Romaguera|2022-06-14T02:28<br><br>.058Z|

#SQL-команда Если удалить запись с `id` равным двум и вставить еще одну запись, то значением поля `id` будет `4`.

```SQL
DELETE FROM users WHERE id = 2;
INSERT INTO users (created_at, email, first_name, last_name, username) VALUES ('2022-06-13 22:36:55.322', 'Angelita.Altenwerth96@hotmail.com', 'Jennyfer', 'Flatley', 'Kayley.Turcotte98');

SELECT * FROM users;
```

[View On DBFiddle](https://www.db-fiddle.com/f/mLbmUrYy9AMKjbFYawkBPB/1)

|   |   |   |   |   |   |
|---|---|---|---|---|---|
|id|username|email|first_name|last_name|created_at|
|1|Duncan3|[Trevion53@yahoo.com](mailto:Trevion53@yahoo.com)|Lucienne|Feil|2022-06-14T18:31<br><br>.296Z|
|3|Margarete_Hegmann6|[Casimer_Cronin@yahoo.com](mailto:Casimer_Cronin@yahoo.com)|Maureen|Romaguera|2022-06-14T02:28<br><br>.058Z|
|4|Kayley.Turcotte98|[AngelitaAngelita.Altenwerth96@hotmail.com](mailto:AngelitaAngelita.Altenwerth96@hotmail.com)|Jennyfer|Flatley|2022-06-13T22:36<br><br>.322Z|

Вот сигнатура автогенерации из документации:

```
column_name type GENERATED { ALWAYS | BY DEFAULT } AS IDENTITY[ ( sequence_option ) ]
```

- Тип данных может быть _SMALLINT_, _INT_ или _BIGINT_
- `GENERATED ALWAYS` -- не позволит добавлять значение самостоятельно, используя `UPDATE` или `INSERT`
- `GENERATED BY DEFAULT` -- в отличие от предыдущего варианта, этот вариант позволяет добавлять значения самостоятельно

PostgreSQL позволяет иметь более одного автогенерируемого поля на таблицу.

#SQL-команда Ниже пример создания таблицы с помощью `GENERATED BY DEFAULT AS IDENTITY`

```SQL
CREATE TABLE users (
    -- Одновременное использование и первичного ключа и автогенерации
    id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    username VARCHAR(50),
    email VARCHAR(255),
    first_name VARCHAR(50),
    last_name VARCHAR(50),
    created_at TIMESTAMP
);

INSERT INTO users (id, created_at, email, first_name, last_name, username) VALUES (1, '2022-06-14 18:31:05.296', 'Trevion53@yahoo.com', 'Lucienne', 'Feil', 'Duncan3');
INSERT INTO users (id, created_at, email, first_name, last_name, username) VALUES (2, '2022-06-14 02:04:13.104', 'Baylee52@yahoo.com', 'Ramiro', 'Wolf', 'Michaela11');
INSERT INTO users (id, created_at, email, first_name, last_name, username) VALUES (3, '2022-06-14 02:28:26.058', 'Casimer_Cronin@yahoo.com', 'Maureen', 'Romaguera', 'Margarete_Hegmann6');
```

[View On DBFiddle](https://www.db-fiddle.com/f/bYPYvudd7BhPmtLYtzDyQE/0)

|id|username|email|first_name|last_name|created_at|
|---|---|---|---|---|---|
|1|Duncan3|[Trevion53@yahoo.com](mailto:Trevion53@yahoo.com)|Lucienne|Feil|2022-06-14 18:31<br><br>.296|
|2|Michaela11|[Baylee52@yahoo.com](mailto:Baylee52@yahoo.com)|Ramiro|Wolf|2022-06-14 02:04<br><br>.104|
|3|Margarete_Hegmann6|[Casimer_Cronin@yahoo.com](mailto:Casimer_Cronin@yahoo.com)|Maureen|

## Дополнительные материалы

- [Документация PRIMARY KEY](https://postgrespro.ru/docs/postgrespro/16/sql-createtable#SQL-CREATETABLE-PARMS-PRIMARY-KEY)
    
- [Документация GENERATED AS IDENTITY](https://postgrespro.ru/docs/postgrespro/16/sql-createtable#SQL-CREATETABLE-PARMS-GENERATED-IDENTITY)