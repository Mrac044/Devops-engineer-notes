## Оператор `GROUP BY`
Группировка данных позволяет объединить одинаковые значения в заданных полях в группы, а затем выполнять подсчеты для каждой группы.

#SQL-команда Для группировки данных существует специальный оператор **`GROUP BY`**. Запрос с подсчетом курсов каждого пользователя будет выглядеть так:

```sql
SELECT
    user_id,
    COUNT(*)
FROM course_members
GROUP BY user_id
ORDER BY user_id;
```

## Псевдонимы для столбцов

Система управления базами данных автоматически присвоила нашему второму столбцу имя `count`, совпадающее с именем функции. Но мы можем переименовать этот столбец, как и любой другой:

```sql
SELECT
    user_id AS student,
    COUNT(*) AS courses_count
FROM course_members
GROUP BY user_id
ORDER BY user_id;
```
#SQL-команда Чтобы присвоить столбцу псевдоним, нужно после его определения записать **`AS`**и указать желаемое имя.

|student|courses_count|
|---|---|
|2|1|
|3|1|
|4|1|
|5|3|
|9|1|
|...||

[View On DB Fiddle](https://www.db-fiddle.com/f/jS4o1UbtrLKTPo3ce328b7/6)

## Как работает GROUP BY

Теперь попытаемся выполнить следующий запрос:

```sql
SELECT
    user_id AS student,
    created_at,
    COUNT(user_id) AS courses_count
FROM course_members
GROUP BY user_id
ORDER BY user_id;
```

Запрос завершится с ошибкой:

```
Query Error: error: column "course_members.created_at" must appear in the GROUP BY clause
or be used in an aggregate function
```
Ошибка в том, что СУБД не понимает, что делать со столбцом `created_at` — либо он должен быть в конструкции `GROUP BY`, либо к нему надо применить агрегатную функцию.

Выведем максимальное значение поля `created_at` для группы. Это будет дата последней регистрации пользователя на курс:

```sql
SELECT
    user_id AS student,
    COUNT(user_id) AS courses_count,
    MAX(created_at) AS last_reg
FROM course_members
GROUP BY user_id
ORDER BY user_id;
```
![[Pasted image 20260207205903.png]]
[View on DB Fiddle](https://www.db-fiddle.com/f/jS4o1UbtrLKTPo3ce328b7/7)


## Дополнительные материалы

- [GROUP BY](https://www.postgresql.org/docs/current/queries-table-expressions.html#QUERIES-GROUP)